<div class="navbar navbar-expand-lg shadow-sm sticky-top" style="background-color:#3f8efc;">
  <div class="container-fluid">
    <!-- Logo -->
    <%= link_to root_path, class: "navbar-brand d-flex align-items-center" do %>
      <%= image_tag "logo.png", alt: "Workstation Logo", height: "40" %>
      <span class="ms-2 fw-bold">Workstation</span>
    <% end %>

    <!-- Toggle (Mobile) -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Links -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
<ul class="navbar-nav me-auto">
  <% if user_signed_in? %>
    <% if current_user.admin? || current_user.supervisor? %>
      <li class="nav-item">
        <%= link_to "Importar 2ART", mapas_path, class: "nav-link" %>
      </li>
      <li class="nav-item">
        <%= link_to "Importar Parâmetros", import_parametro_calculos_path, class: "nav-link" %>
      </li>
      <li class="nav-item">
        <%= link_to "Importar WMS", new_import_wms_tasks_path, class: "nav-link" %>
      </li>

      <!-- Dropdown DU -->
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="duDropdown" role="button" data-bs-toggle="dropdown">
          DU
        </a>
        <ul class="dropdown-menu">
          <li>
            <%= link_to drivers_path, class: "dropdown-item" do %>
              <i class="bi bi-truck-front me-2"></i> Motoristas
            <% end %>
          </li>
          <li>
            <%= link_to ajudantes_path, class: "dropdown-item" do %>
              <i class="bi bi-people me-2"></i> Ajudantes
            <% end %>
          </li>
          <li>
            <%= link_to mapas_todos_path, class: "dropdown-item" do %>
              <i class="bi bi-map me-2"></i> Mapas
            <% end %>
          </li>
          <li>
            <%= link_to fuel_consumptions_path, class: "dropdown-item" do %>
              <i class="bi bi-fuel-pump me-2"></i> Consumo de Combustível
            <% end %>
          </li>
        </ul>
      </li>

      <!-- Dropdown AZ -->
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="azDropdown" role="button" data-bs-toggle="dropdown">
          AZ
        </a>
        <ul class="dropdown-menu">
          <li>
            <%= link_to operators_path, class: "dropdown-item" do %>
              <i class="bi bi-person-workspace me-2"></i> Operadores
            <% end %>
          </li>
          <li>
            <%= link_to az_ajudantes_path, class: "dropdown-item" do %>
              <i class="bi bi-people-fill me-2"></i> Ajudantes
            <% end %>
          </li>
          <li>
            <%= link_to az_mapas_path, class: "dropdown-item" do %>
              <i class="bi bi-calendar-check me-2"></i> Resultados Diários
            <% end %>
          </li>
          <li>
            <%= link_to wms_tasks_path, class: "dropdown-item" do %>
              <i class="bi bi-bar-chart-line me-2"></i> Resultados WMS
            <% end %>
          </li>
        </ul>
      </li>
    <% end %>
  <% end %>
</ul>

      <!-- Avatar Dropdown -->
      <% if user_signed_in? %>
        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a href="#" class="nav-link" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
            <% if current_user.photo.attached? %>
              <%= cl_image_tag current_user.photo.key,
                width: 40,
                height: 40,
                crop: :fill,
                gravity: :face,
                class: "rounded-circle shadow-sm border border-2 border-white",
                alt: "Avatar" %>
            <% else %>
              <div class="d-flex align-items-center justify-content-center rounded-circle shadow-sm border border-2 border-white bg-light"
                  style="width: 40px; height: 40px;">
                <i class="bi bi-person-fill text-secondary"></i>
              </div>
            <% end %>
            </a>

            <div class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="navbarDropdown">

              <% if current_user.admin? || current_user.supervisor? %>
                <h6 class="dropdown-header text-uppercase small text-muted">Módulos</h6>
                <%= link_to invoices_path, class: "dropdown-item fw-bold text-primary d-flex justify-content-between align-items-center" do %>
                  <i class="bi bi-cash-coin me-2"></i> Workstation Fin
                  <span class="badge bg-success">New</span>
                <% end %>
                <%= link_to root_path, class: "dropdown-item" do %>
                  <i class="bi bi-kanban me-2"></i> Workstation RV
                <% end %>
                <div class="dropdown-divider"></div>
              <% end %>

              <h6 class="dropdown-header text-uppercase small text-muted">Formulários</h6>
              <%= link_to checklists_path, class: "dropdown-item" do %>
                <i class="bi bi-ui-checks me-2"></i> Formulários
              <% end %>
              <% if current_user.admin? %>
                <%= link_to checklist_templates_path, class: "dropdown-item" do %>
                  <i class="bi bi-list-check me-2"></i> Tipos de Formulários
                <% end %>
              <% end %>
              <%= link_to autonomies_path, class: "dropdown-item" do %>
                <i class="bi bi-clipboard-data me-2"></i> Relatórios de formulários
              <% end %>
              <div class="dropdown-divider"></div>

              <h6 class="dropdown-header text-uppercase small text-muted">Geral</h6>
              <%= link_to downloads_path, class: "dropdown-item" do %>
                <i class="bi bi-book me-2"></i> Padrões e LUP's
              <% end %>
              <%= link_to autonomies_path, class: "dropdown-item" do %>
                <i class="bi bi-truck me-2"></i> Autonomia de Frota
              <% end %>
              <%= link_to parametro_calculos_path, class: "dropdown-item" do %>
                <i class="bi bi-sliders me-2"></i> Parâmetros
              <% end %>
              <% if current_user.admin? %>
                <%= link_to plates_path, class: "dropdown-item" do %>
                  <i class="bi bi-car-front me-2"></i> Placas Cadastradas
                <% end %>
                <%= link_to admin_users_path, class: "dropdown-item" do %>
                  <i class="bi bi-person-lines-fill me-2"></i> Usuários
                <% end %>
              <% end %>
              <div class="dropdown-divider"></div>

              <%= link_to edit_user_registration_path, class: "dropdown-item" do %>
                <i class="bi bi-person-circle me-2"></i> Editar cadastro
              <% end %>
              <%= link_to destroy_user_session_path, data: {turbo_method: :delete}, class: "dropdown-item text-danger fw-bold" do %>
                <i class="bi bi-box-arrow-right me-2"></i> Log out
              <% end %>
            </div>
          </li>
        </ul>
      <% else %>
        <%= link_to "Login", new_user_session_path, class: "btn btn-outline-dark" %>
      <% end %>
    </div>
  </div>
</div>
